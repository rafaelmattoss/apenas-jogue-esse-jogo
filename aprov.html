<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="aprov.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
</head>
<body>

    <div>
        <span id="aprovv" class="material-symbols-outlined">
            task_alt
            </span>
        <h1>Pagamento Aprovado</h1>
    </div>
    
</body>
<script>
    document.addEventListener("DOMContentLoaded", () => {
        const urlParams = new URLSearchParams(window.location.search);
        const sessionId = urlParams.get('session_id');

        

        if (sessionId) {
            fetch(`https://us-central1-apenas-jogue-esse-jogo.cloudfunctions.net/verifyCheckoutSession?session_id=${sessionId}`)
                .then(response => response.json())
                .then(async data => {
                    if (data.paid) {
                        // Atualize o status do usuário para premium no Firestore
                        await fetch('https://us-central1-apenas-jogue-esse-jogo.cloudfunctions.net/updateUserStatus', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({ userId: data.userId, premium: true })
                        });

                        alert('Você agora é um usuário premium!');
                    } else {
                        alert('O pagamento não foi concluído. Tente novamente.');
                    }
                })
                .catch(error => console.error('Erro ao verificar a sessão de pagamento:', error));
        }
    });
</script>

</html>